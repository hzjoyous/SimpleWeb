<!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  
  <title>Page 5 | biubiubiu~</title>
  <meta name="author" content="hzjoyous">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="biubiubiu~"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/web/blog/favicon.png" rel="icon">
  <link rel="alternate" href="/web/blog/atom.xml" title="biubiubiu~" type="application/atom+xml">
  <link rel="stylesheet" href="/web/blog/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/web/blog/">biubiubiu~</a></h1>
  <h2><a href="/web/blog/">快乐~</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/web/blog/">Home</a></li>
    
      <li><a href="/web/blog/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article id="post-other/vargrant" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-11-04T07:25:38.000Z"><a href="/web/blog/2018/11/04/other/vargrant/">2018-11-04</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/11/04/other/vargrant/">使用 vargrant 运行 lnmp 环境</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant init      # 初始化    </span><br><span class="line">$ vagrant up        # 启动虚拟机  </span><br><span class="line">$ vagrant halt      # 关闭虚拟机  </span><br><span class="line">$ vagrant reload    # 重启虚拟机  </span><br><span class="line">$ vagrant ssh       # SSH 至虚拟机  </span><br><span class="line">$ vagrant suspend   # 挂起虚拟机  </span><br><span class="line">$ vagrant resume    # 唤醒虚拟机  </span><br><span class="line">$ vagrant status    # 查看虚拟机运行状态  </span><br><span class="line">$ vagrant destroy   # 销毁当前虚拟机  </span><br><span class="line">#box管理命令  </span><br><span class="line">$ vagrant box list    # 查看本地box列表  </span><br><span class="line">$ vagrant box add     # 添加box到列表  </span><br><span class="line">$ vagrant box remove  # 从box列表移除</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 更改Homestead.yaml 后 执行以下指令，进行重新配置</span><br><span class="line">vagrant.exe up --provision</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&gt; homestead-7: Machine already provisioned. Run &#96;vagrant provision&#96; or use the &#96;--provision&#96;</span><br></pre></td></tr></table></figure>






      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_012_typeCode" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:45.000Z"><a href="/web/blog/2018/10/27/php/php_012_typeCode/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_012_typeCode/">PHP[012]:TypeCode</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>如何利用php严格模式写出理想的代码</p>
<p>php限定类型</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnIntByBool</span><span class="params">(bool $param)</span>:<span class="title">int</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($param)&#123;</span><br><span class="line">        $result = <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $result = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>php严格模式开启</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> (strict_types = <span class="number">1</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">declare</span> (strict_types = <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnArr</span><span class="params">($param)</span> : <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($param) &#123;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    var_dump(returnArr(<span class="number">1</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Throwable $e) &#123;</span><br><span class="line">    <span class="keyword">echo</span> ($e-&gt;getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    var_dump(returnArr(<span class="number">0</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Throwable $e) &#123;</span><br><span class="line">    <span class="keyword">echo</span> ($e-&gt;getMessage() . PHP_EOL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnArrByBoolean</span><span class="params">(bool $param)</span> : <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($param) &#123;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    var_dump(returnArrByBoolean(<span class="number">1</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Throwable $e) &#123;</span><br><span class="line">    <span class="keyword">echo</span> ($e-&gt;getMessage() . PHP_EOL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    var_dump(returnArrByBoolean(<span class="keyword">true</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Throwable $e) &#123;</span><br><span class="line">    <span class="keyword">echo</span> ($e-&gt;getMessage() . PHP_EOL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnArrayByBooleanUseFormat</span><span class="params">(bool $param)</span> : <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $result = [];</span><br><span class="line">    <span class="keyword">if</span> ($param) &#123;</span><br><span class="line">        $result = [<span class="string">'param'</span> =&gt; <span class="keyword">true</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    var_dump(returnArrayByBooleanUseFormat(<span class="keyword">true</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Throwable $e) &#123;</span><br><span class="line">    <span class="keyword">echo</span> ($e-&gt;getMessage() . PHP_EOL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    var_dump(returnArrayByBooleanUseFormat(<span class="keyword">false</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Throwable $e) &#123;</span><br><span class="line">    <span class="keyword">echo</span> ($e-&gt;getMessage() . PHP_EOL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_011_curl" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:44.000Z"><a href="/web/blog/2018/10/27/php/php_011_curl/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_011_curl/">PHP[011]:curl</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p>今天在研究了下 php curl cookie的使用 , 本來打算写一篇关于 php curl 的使用，主要是关于 cookie 的，但是 curl 在一定程度上相比于 socket 算是一个经过封装的扩展，所以写的过程中又引入了一个使用 socket 进行 http 请求的文章</p>
<blockquote>
<p>PHP 支持 Daniel Stenberg 创建的 libcurl 库，能够连接通讯各种服务器、使用各种协议。libcurl 目前支持的协议有 http、https、ftp、gopher、telnet、dict、file、ldap。 libcurl 同时支持 HTTPS 证书、HTTP POST、HTTP PUT、 FTP 上传(也能通过 PHP 的 FTP 扩展完成)、HTTP 基于表单的上传、代理、cookies、用户名+密码的认证</p>
</blockquote>
<p>curl 基础用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ch &#x3D; curl_init();</span><br><span class="line">curl_setopt($ch,xxx,xxx);</span><br><span class="line">curl_setopt_array($ch,[]);</span><br><span class="line">curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br></pre></td></tr></table></figure>

<h3 id="使用socket进行http访问-（这一部分可以跳过，之后再看）"><a href="#使用socket进行http访问-（这一部分可以跳过，之后再看）" class="headerlink" title="使用socket进行http访问 （这一部分可以跳过，之后再看）"></a>使用socket进行http访问 （这一部分可以跳过，之后再看）</h3><p>这是一段使用 php socket 模拟 http get 请求的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * super socket client</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">define(<span class="string">'GET'</span>, <span class="string">'GET'</span>);</span><br><span class="line">define(<span class="string">'POST'</span>, <span class="string">'POST'</span>);</span><br><span class="line">define(<span class="string">'sp'</span>, <span class="string">"\r\n"</span>);</span><br><span class="line">$url                     = <span class="string">'http://localhost:8080/'</span>;</span><br><span class="line">$url                     = <span class="string">'https://www.xiaozhu.com/'</span>;</span><br><span class="line">$body                    = <span class="string">''</span>;</span><br><span class="line">$protocol                = <span class="string">'HTTP/1.1'</span>;</span><br><span class="line">$urlInfo                 = parse_url($url);</span><br><span class="line">$host                    = $urlInfo[<span class="string">'host'</span>];</span><br><span class="line">$port                    = $urlInfo[<span class="string">'port'</span>] ?? <span class="string">'80'</span>;</span><br><span class="line">$headerArr               = [</span><br><span class="line">    <span class="string">'Host'</span> =&gt; $host</span><br><span class="line">];</span><br><span class="line">$headerArr[<span class="string">'User-Agent'</span>] = <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36'</span>;</span><br><span class="line"><span class="keyword">if</span> (stristr($url, <span class="string">'xiaozhu'</span>)) &#123;</span><br><span class="line">    $headerArr[<span class="string">'connection'</span>] = <span class="string">'close'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$method                  = GET;</span><br><span class="line">$requestLine             = $method . <span class="string">' '</span> . $urlInfo[<span class="string">'path'</span>] . <span class="string">''</span> . <span class="string">'?'</span> . ($urlInfo[<span class="string">'query'</span>] ?? <span class="string">''</span>) . <span class="string">' '</span> . $protocol;</span><br><span class="line">$header                  = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">foreach</span> ($headerArr <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    $header .= $header == <span class="string">''</span> ? ($key . <span class="string">':'</span> . $value) : (sp . $key . <span class="string">':'</span> . $value);</span><br><span class="line">&#125;</span><br><span class="line">$requestHeader = $header . sp . sp;</span><br><span class="line">$requestInfo   = $requestLine . sp . $requestHeader;</span><br><span class="line">$requestInfo   .= $body;</span><br><span class="line"></span><br><span class="line">$fp = fsockopen($host, $port, $errno, $errStr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$fp) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $errStr . <span class="string">'('</span> . $errno . <span class="string">')'</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readByFEof</span><span class="params">($fp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $str = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">while</span> (!feof($fp)) &#123;</span><br><span class="line">        $result = fread($fp, <span class="number">1024</span>);</span><br><span class="line">        $str    .= $result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fwrite($fp, $requestInfo)) &#123;</span><br><span class="line">    $responseInfo = readByFEof($fp);</span><br><span class="line">&#125;</span><br><span class="line">fclose($fp);</span><br><span class="line"><span class="keyword">echo</span> $responseInfo;</span><br></pre></td></tr></table></figure>
<p>这是一段使用 php socket 模拟 http get 请求的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * super socket client</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">define(<span class="string">'GET'</span>, <span class="string">'GET'</span>);</span><br><span class="line">define(<span class="string">'POST'</span>, <span class="string">'POST'</span>);</span><br><span class="line">define(<span class="string">'sp'</span>, <span class="string">"\r\n"</span>);</span><br><span class="line"><span class="comment">//$url = 'http://localhost:8080/';</span></span><br><span class="line">$url                         = <span class="string">'http://www.xiaozhu.com/'</span>;</span><br><span class="line">$body                        = <span class="string">''</span>;</span><br><span class="line">$protocol                    = <span class="string">'HTTP/1.1'</span>;</span><br><span class="line">$urlInfo                     = parse_url($url);</span><br><span class="line">$host                        = $urlInfo[<span class="string">'host'</span>];</span><br><span class="line">$port                        = $urlInfo[<span class="string">'port'</span>] ?? <span class="string">'80'</span>;</span><br><span class="line">$headerArr                   = [</span><br><span class="line">    <span class="string">'Host'</span> =&gt; $host</span><br><span class="line">];</span><br><span class="line">$postData                    = [<span class="string">'username'</span> =&gt; <span class="string">'发一个中文'</span>, <span class="string">'age'</span> =&gt; <span class="number">22</span>];</span><br><span class="line">$body                        = http_build_query($postData);</span><br><span class="line">$headerArr[<span class="string">'User-Agent'</span>]     = <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36'</span>;</span><br><span class="line">$headerArr[<span class="string">'Content-Type'</span>]   = <span class="string">'application/x-www-form-urlencoded'</span>;</span><br><span class="line">$headerArr[<span class="string">'Content-Length'</span>] = strlen($body);</span><br><span class="line">$headerArr[<span class="string">'cookie'</span>]         = <span class="string">'name=1417760419;'</span>;</span><br><span class="line"><span class="keyword">if</span> (stristr($url, <span class="string">'xiaozhu'</span>)) &#123;</span><br><span class="line">    $headerArr[<span class="string">'connection'</span>] = <span class="string">'close'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$method      = POST;</span><br><span class="line">$requestLine = $method . <span class="string">' '</span> . $urlInfo[<span class="string">'path'</span>] . <span class="string">''</span> . <span class="string">'?'</span> . ($urlInfo[<span class="string">'query'</span>] ?? <span class="string">''</span>) . <span class="string">' '</span> . $protocol;</span><br><span class="line">$header      = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">foreach</span> ($headerArr <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    $header .= $header == <span class="string">''</span> ? ($key . <span class="string">':'</span> . $value) : (sp . $key . <span class="string">':'</span> . $value);</span><br><span class="line">&#125;</span><br><span class="line">$requestHeader = $header . sp . sp;</span><br><span class="line">$requestInfo   = $requestLine . sp . $requestHeader;</span><br><span class="line">$requestInfo   .= $body;</span><br><span class="line"></span><br><span class="line">$fp = fsockopen($host, $port, $errno, $errStr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$fp) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $errStr . <span class="string">'('</span> . $errno . <span class="string">')'</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PHP 的 feof() 函数用于检测是否已到达文件末尾 (eof)。如果文件指针到了 EOF 或者出错时则返回 TRUE，否则返回一个错误（包括 socket 超时），其它情况则返回 FALSE。</span></span><br><span class="line"><span class="comment"> * while (!feof($fp)) 即当文件指针没有达到 End Of File，就循环读入数据直至读完。这是一个常见用法，我们使用fsockopen打开一个$fp来发送http头，请求后用feof判断是否读完来获取服务器响应的内容。</span></span><br><span class="line"><span class="comment"> * 但是这使用feof时要特别注意一点，php手册上关于feof有这样一个说明：</span></span><br><span class="line"><span class="comment"> * Warning：如果服务器没有关闭由 fsockopen() 所打开的连接，feof() 会一直等待直到超时而返回 TRUE。默认的超时限制是 60 秒，可以使用 stream_set_timeout() 来改变这个值。</span></span><br><span class="line"><span class="comment"> * 也就是一个打开的socket连接，没有在读完后关闭，feof会一直返回true直到超时。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readByFEof</span><span class="params">($fp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $str = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">while</span> (!feof($fp)) &#123;</span><br><span class="line">        $result = fread($fp, <span class="number">1024</span>);</span><br><span class="line">        $str .= $result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fwrite($fp, $requestInfo)) &#123;</span><br><span class="line">    $responseInfo = readByFEof($fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $responseInfo;</span><br></pre></td></tr></table></figure>

<h3 id="curl-进行请求"><a href="#curl-进行请求" class="headerlink" title="curl 进行请求"></a>curl 进行请求</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$url         = <span class="string">'http://localhost:8080/'</span>;</span><br><span class="line">$path        = <span class="keyword">__DIR__</span> . <span class="string">'/tmp'</span>;</span><br><span class="line">$cookie_file = $path . <span class="string">'/cookie.txt'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!file_exists($cookie_file)) &#123;</span><br><span class="line">    file_put_contents($cookie_file, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">$ch = curl_init();</span><br><span class="line"></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line"></span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">curl_setopt_array($ch, [</span><br><span class="line">    CURLOPT_URL            =&gt; $url,</span><br><span class="line">    CURLOPT_RETURNTRANSFER =&gt; <span class="keyword">true</span>,</span><br><span class="line">    CURLOPT_ENCODING       =&gt; <span class="string">''</span>,</span><br><span class="line">    CURLOPT_MAXREDIRS      =&gt; <span class="number">10</span>,</span><br><span class="line">    CURLOPT_TIMEOUT        =&gt; <span class="number">60</span>,</span><br><span class="line">    CURLOPT_HTTP_VERSION   =&gt; CURL_HTTP_VERSION_1_1,</span><br><span class="line">    CURLOPT_CUSTOMREQUEST  =&gt; <span class="string">'POST'</span>,</span><br><span class="line">    CURLOPT_COOKIEFILE     =&gt; $cookie_file,</span><br><span class="line">    CURLOPT_COOKIEJAR      =&gt; $cookie_file,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $cookie = 'a=b;c=d;name=方世玉';</span></span><br><span class="line"><span class="comment">// curl_setopt($ch, CURLOPT_COOKIE, $cookie);</span></span><br><span class="line"><span class="comment">// exec</span></span><br><span class="line"></span><br><span class="line">$output = curl_exec($ch);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($output === <span class="keyword">FALSE</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'CURL Error:'</span> . curl_error($ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// close</span></span><br><span class="line"></span><br><span class="line">curl_close($ch);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $output;</span><br></pre></td></tr></table></figure>

<p>上面就是一个带有 cookie 的 http 请求，cookie 在 php-curl 的设置中有4种</p>
<p>（ 我才发现我用的这个主题不支持表格md mmp)</p>
<ul>
<li>CURLOPT_COOKIE     <ul>
<li>包含 cookie 数据的文件名，cookie 文件的格式可以是 Netscape 格式，或者只是纯 HTTP 头部风格，存入文件。如果文件名是空的，不会加载 cookie，但 cookie 的处理仍旧启用。 </li>
</ul>
</li>
<li>CURLOPT_COOKIEFILE <ul>
<li>包含 cookie 数据的文件名，cookie 文件的格式可以是 Netscape 格式，或者只是纯 HTTP 头部风格，存入文件。如果文件名是空的，不会加载 cookie，但 cookie 的处理仍旧启用。 </li>
</ul>
</li>
<li>CURLOPT_COOKIEJAR  <ul>
<li>连接结束后，比如，调用 curl_close 后，保存 cookie 信息的文件。                                                                                                     |</li>
</ul>
</li>
</ul>
<p>还有一种方法就是在header中直接设置</p>
<p>正常使用的话 CURLOPT_COOKIEFILE , CURLOPT_COOKIEJAR 这两个设置使用起来很方便如果使用其他的方式的话，那么需要自行处理 cookie 的存储</p>
<p>在使用 CURLOPT_COOKIEJAR 发现了一个有趣的事，相比与日常使用的浏览器（谷歌，edge等），我们使用脚本进行请求cookie请求会将cookie保存起来并不会过期这就会导致尽管cookie已经过期了但是仍然传送了过去，其实从某些方面来说也可以把这个作为一个辨别是否是爬虫的手段（手动滑稽）</p>
<p>在使用 socket 进行 http 模拟的时候很明显就能感觉到是字符串在通信，传过去的和传回来的都是按格式规整好的字符串</p>
<p>发送</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host:localhost</span></span><br><span class="line">User-Agent:Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type:application/x-www-form-urlencoded</span></span><br><span class="line"><span class="attribute">Content-Length:61</span></span><br><span class="line">cookie:name=1417760419;</span><br><span class="line"></span><br><span class="line">username=%E5%8F%91%E4%B8%80%E4%B8%AA%E4%B8%AD%E6%96%87&amp;age=22</span><br></pre></td></tr></table></figure>
<p>返回</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Host</span>: localhost</span><br><span class="line"><span class="attribute">Date</span>: Sun, 10 Feb 2019 23:15:08 +0800</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">X-Powered-By</span>: PHP/7.2.10-0ubuntu0.18.04.1</span><br><span class="line"><span class="attribute">Set-Cookie</span>: mc1549811708=my+cookie+value</span><br><span class="line"><span class="attribute">Set-Cookie</span>: mc=my+cookie+value; expires=Sun, 10-Feb-2019 15:15:07 GMT; Max-Age=0</span><br><span class="line"><span class="attribute">Content-type</span>: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">array (</span><br><span class="line">    ....//太多了省略其实也就是一堆字符串</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>很容易看到一些关于 http 协议的参数，其中我在测试我们公司的主站时由于公司的服务器并没有主动断开 socket ，而我是用的 feof 读取返回值就导致程序一直等啊等，这一点我没有细做调试，所以也不太清楚是出在 nginx 上还是 php， 但是确实是可以让客户端和服务端建立长久的无用链接如果在客户端设置 Connection: close，也可以解决这种问题，而这种问题出现的源头是http1.1支持相关网络请求相关的实现，有兴趣的同学可以自行研究一下（手动狗头）</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_010_codeception" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:43.000Z"><a href="/web/blog/2018/10/27/php/php_010_codeception/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_010_codeception/">PHP[010]:codeception</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h1 id="codeception"><a href="#codeception" class="headerlink" title="codeception"></a>codeception</h1><p>创建单元测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">.\vendor\bin\codecept run g:<span class="built_in">test</span> unit src/CouponAccountClient</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Test was created <span class="keyword">in</span> C:\Users\hzj\Desktop\xz\xz_stub-client\tests\unit\src\CouponAccountClientTest.php</span></span><br></pre></td></tr></table></figure>
<p>运行单元测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">  .\vendor\bin\codecept run  tests\unit\src\CouponAccountClientTest.php</span></span><br><span class="line">Codeception PHP Testing Framework v2.5.1</span><br><span class="line">Powered by PHPUnit 7.3.5 by Sebastian Bergmann and contributors.</span><br><span class="line">Running with seed:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Unit Tests (1) -------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">+ CouponAccountClientTest: Some feature (0.03s)</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Time: 749 ms, Memory: 10.00MB</span><br><span class="line"></span><br><span class="line">OK (1 test, 0 assertions)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_009_爬虫" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:42.000Z"><a href="/web/blog/2018/10/27/php/php_009_爬虫/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_009_爬虫/">PHP[009]:爬虫</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a href="https://learnku.com/laravel/t/17492" target="_blank" rel="noopener">php爬虫</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 异步 HTTP 客户端</span><br><span class="line">composer require clue&#x2F;buzz-react</span><br><span class="line"># DomCrawler 的适配组件 CSS-selector </span><br><span class="line">composer require symfony&#x2F;dom-crawler</span><br><span class="line"></span><br><span class="line">composer require symfony&#x2F;css-selector</span><br><span class="line"></span><br><span class="line"># 异步处理文件</span><br><span class="line">composer require react&#x2F;filesystem</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_008_延迟触发器" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:41.000Z"><a href="/web/blog/2018/10/27/php/php_008_延迟触发器/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_008_延迟触发器/">PHP[008]:实现延迟触发器</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$timeManager = [];</span><br><span class="line">$timeMark = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">$i = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">while</span> ($i--) &#123;</span><br><span class="line">    $jobTime = (time() + mt_rand(<span class="number">0</span>, <span class="number">1000</span>));</span><br><span class="line">    <span class="keyword">echo</span> (<span class="number">1000</span> - $i) . <span class="string">'个任务 将于'</span> . date(<span class="string">'Y-m-d H:i:s'</span>, $jobTime) . <span class="string">'执行'</span> . PHP_EOL;</span><br><span class="line">    $timeManager[$jobTime][] = <span class="string">'$i 任务 '</span> . $i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    ksort($timeManager);</span><br><span class="line">    $timeMark = key($timeManager);</span><br><span class="line">    <span class="keyword">if</span> (count($timeManager) &gt; <span class="number">0</span> &amp;&amp; $timeMark &lt; time()) &#123;</span><br><span class="line">        var_dump($timeMark);</span><br><span class="line">        var_dump(date(<span class="string">'Y-m-d H:i:s'</span>, $timeMark));</span><br><span class="line">        $job = $timeManager[$timeMark];</span><br><span class="line">        <span class="keyword">unset</span>($timeManager[$timeMark]);</span><br><span class="line">        <span class="comment">#$job = array_shift($timeManager);</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_007_ReflectionClass" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:40.000Z"><a href="/web/blog/2018/10/27/php/php_007_ReflectionClass/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_007_ReflectionClass/">PHP[007]:ReflectionClass</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h2 id="调用类私用方法"><a href="#调用类私用方法" class="headerlink" title="调用类私用方法"></a>调用类私用方法</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">want</span><span class="params">($see)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $see.$see.$see.PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$reflector = <span class="keyword">new</span> ReflectionClass(Cat::class);</span><br><span class="line">$instance  = $reflector-&gt;newInstance();</span><br><span class="line">$method    = $reflector-&gt;getmethod(<span class="string">'want'</span>);</span><br><span class="line">$method-&gt;setAccessible(<span class="keyword">true</span>);</span><br><span class="line">$result = $method-&gt;invoke($instance, <span class="string">'eat food '</span>);</span><br></pre></td></tr></table></figure>

<h2 id="实例化不可实例的类"><a href="#实例化不可实例的类" class="headerlink" title="实例化不可实例的类"></a>实例化不可实例的类</h2><p>使用这个的原因是因为拆分老的业务代码中，有个一个 Aentity 依赖另一个 Bentity （在orm层中调用get_class），如果查询或者Bentity提供的创建方法会导致将其注册到 UnitOfWork 中，会导致最后的入库（虽然也有可能不入库），所以采用  ReflectionClass::newInstanceWithoutConstructor 实例化一个在 get_class 范围内等价的 entity ,并将其作为一个临时的参数对象代替 Bentity 维持代码的运作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">println</span><span class="params">(String $str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>($str.PHP_EOL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name = <span class="string">'WangCai'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setName</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$reflector = <span class="keyword">new</span> ReflectionClass(Dog::class);</span><br><span class="line">$dog = $reflector-&gt;newInstanceWithoutConstructor();</span><br><span class="line">$dog-&gt;setName(<span class="string">'DeFu'</span>);</span><br><span class="line">$class = get_class($dog);</span><br><span class="line">println($class);</span><br><span class="line">println($dog-&gt;getName());</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_006_单进程多任务并行实现" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:39.000Z"><a href="/web/blog/2018/10/27/php/php_006_单进程多任务并行实现/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_006_单进程多任务并行实现/">PHP[006]:单进程多任务并行处理实现</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$i = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">$str = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">\$logName = basename(__FILE__);</span></span><br><span class="line"><span class="string">\$i =1;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\$result = '';</span></span><br><span class="line"><span class="string">\$result .= "初始: " . memory_get_usage() . "B\n";</span></span><br><span class="line"><span class="string">\$result .= "使用: " . memory_get_usage() . "B\n";</span></span><br><span class="line"><span class="string">while(\$i--)&#123;</span></span><br><span class="line"><span class="string">    sleep(10);</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    \$result .= "释放: " . memory_get_usage() . "B\n";</span></span><br><span class="line"><span class="string">    \$result .= "峰值: " . memory_get_peak_usage() . "B\n";</span></span><br><span class="line"><span class="string">    file_put_contents(__DIR__.'/'.\$logName.'.log',time().PHP_EOL.\$result,FILE_APPEND);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$file_name = [];</span><br><span class="line"><span class="keyword">while</span> ($i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    $file_name[] = <span class="string">'timeEvent'</span> . $i . <span class="string">'.php'</span>;</span><br><span class="line">    file_put_contents(<span class="keyword">__DIR__</span> . <span class="string">'/'</span> . <span class="string">'timeEvent'</span> . $i . <span class="string">'.php'</span>, $str);</span><br><span class="line">    $i++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var_dump($file_name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($file_name <span class="keyword">as</span> $name) &#123;</span><br><span class="line"></span><br><span class="line">    $strRun = <span class="string">'php '</span> . <span class="keyword">__DIR__</span> . <span class="string">'/'</span> . $name . <span class="string">' &amp;'</span>;</span><br><span class="line">    $waitClose = pclose(popen($strRun, <span class="string">'r'</span>));</span><br><span class="line">    <span class="keyword">echo</span> time() . PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line">$result = <span class="string">''</span>;</span><br><span class="line">$result .= <span class="string">"初始: "</span> . memory_get_usage() . <span class="string">"B\n"</span>;</span><br><span class="line">$result .= <span class="string">"使用: "</span> . memory_get_usage() . <span class="string">"B\n"</span>;</span><br><span class="line">$result .= <span class="string">"释放: "</span> . memory_get_usage() . <span class="string">"B\n"</span>;</span><br><span class="line">$result .= <span class="string">"峰值: "</span> . memory_get_peak_usage() . <span class="string">"B\n"</span>;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_005_function" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:38.000Z"><a href="/web/blog/2018/10/27/php/php_005_function/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_005_function/">PHP[005]:function</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line">debug_print_backtrace($needBacktrace === <span class="number">2</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">$trace = ob_get_contents();</span><br><span class="line">ob_end_clean();</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">'PROJECT_START'</span>, microtime(<span class="keyword">true</span>));</span><br><span class="line">$message = [</span><br><span class="line">    <span class="string">'memory_used'</span>  =&gt; memory_get_usage(),</span><br><span class="line">    <span class="string">'running_time'</span> =&gt; (microtime(<span class="keyword">true</span>) - PROJECT_START),</span><br><span class="line">    <span class="string">'action_name'</span>  =&gt; $actionName</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article id="post-php/php_003_symfony" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2018-10-27T01:48:36.000Z"><a href="/web/blog/2018/10/27/php/php_003_symfony/">2018-10-27</a></time>
      
      
  
    <h1 class="title"><a href="/web/blog/2018/10/27/php/php_003_symfony/">PHP[003]:symfony</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">composer create-project symfony&#x2F;skeleton my-project</span><br><span class="line">cd my-project</span><br><span class="line">composer require symfony&#x2F;web-server-bundle --dev</span><br><span class="line">composer require annotations         # 注释分析</span><br><span class="line">composer require symfony&#x2F;orm-pack</span><br><span class="line">composer require symfony&#x2F;maker-bundle --dev</span><br><span class="line">composer require --dev symfony&#x2F;profiler-pack # 开发调试工具</span><br><span class="line">composer require sensio&#x2F;framework-extra-bundle # 自动查询</span><br><span class="line">composer require doctrine&#x2F;doctrine-fixtures-bundle --dev  # 测试数据</span><br><span class="line">composer require symfony&#x2F;messenger</span><br><span class="line">composer require symfony&#x2F;serializer-pack #待定</span><br></pre></td></tr></table></figure>


<h3 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">symfony 提供两种项目 symfony/skeleton 是轻量的， symfony/website-skeleton 是比较重的，具有较全的web功能</span></span><br><span class="line"><span class="meta">#</span><span class="bash">选择轻量的面向 api 和 console 的 symfony/skeleton 起步</span></span><br><span class="line"><span class="meta">#</span><span class="bash">使用 composer 安装symfony</span></span><br><span class="line">composer create-project symfony/skeleton my-project</span><br><span class="line"><span class="meta">#</span><span class="bash">使用 symfony-cli 安装symfony</span></span><br><span class="line">symfony new xz_symfony</span><br></pre></td></tr></table></figure>

<p>symfony<a href="https://symfony.com/doc/current/setup/web_server_configuration.html" target="_blank" rel="noopener">Configuring a Web Server</a><br>symfony<a href="https://symfony.com/doc/current/reference/requirements.html" target="_blank" rel="noopener">Requirements for Running Symfony</a><br>进入项目安装开发时使用的 web server 组件  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd xz_symfony</span><br><span class="line">composer require symfony/web-server-bundle --dev</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">composer require annotations         # 注释分析</span><br><span class="line">php bin/console debug:router         # 查看所有的路由</span><br><span class="line">composer require symfony/twig-bundle # symfony 的模板引擎</span><br><span class="line">php bin/console debug:autowiring     # 查看所有可以注入的服务</span><br></pre></td></tr></table></figure>

<p><a href="https://symfony.com/doc/current/bundles/SymfonyMakerBundle/index.html" target="_blank" rel="noopener">The Symfony MakerBundle</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">composer require symfony/maker-bundle --dev          # 引入 maker-bundle</span><br><span class="line">php bin/console make:controller BrandNewController   # 创建一个新的控制器</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php bin&#x2F;console config:dump-reference framework</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">composer require symfony&#x2F;orm-pack</span><br><span class="line">composer require symfony&#x2F;maker-bundle --dev</span><br><span class="line">php bin&#x2F;console doctrine:database:create</span><br><span class="line">php bin&#x2F;console list doctrine</span><br><span class="line">php bin&#x2F;console make:entity</span><br><span class="line">php bin&#x2F;console make:migration</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php bin&#x2F;console doctrine:query:sql &#39;SELECT * FROM product&#39;</span><br><span class="line">composer require sensio&#x2F;framework-extra-bundle # 自动查询</span><br><span class="line">composer require doctrine&#x2F;doctrine-fixtures-bundle --dev  # 测试数据</span><br><span class="line">php bin&#x2F;console doctrine:fixtures:load</span><br></pre></td></tr></table></figure>


<p>next</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 全局唯一id</span><br><span class="line"># fixtures 文件的生成位置</span><br><span class="line">php bin&#x2F;console make:fixtures</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/web/blog/page/4/" class="alignleft prev">Prev</a>
  
  
    <a href="/web/blog/page/6/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="as_sitesearch" value="hzjoyous.github.io/web/blog">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/web/blog/categories/c/">c</a><small>11</small></li>
  
    <li><a href="/web/blog/categories/mysql/">mysql</a><small>1</small></li>
  
    <li><a href="/web/blog/categories/node/">node</a><small>1</small></li>
  
    <li><a href="/web/blog/categories/other/">other</a><small>14</small></li>
  
    <li><a href="/web/blog/categories/php/">php</a><small>23</small></li>
  
    <li><a href="/web/blog/categories/python/">python</a><small>1</small></li>
  
    <li><a href="/web/blog/categories/tool/">tool</a><small>7</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/web/blog/tags/blog/">blog</a><small>3</small></li>
  
    <li><a href="/web/blog/tags/c/">c</a><small>11</small></li>
  
    <li><a href="/web/blog/tags/command/">command</a><small>1</small></li>
  
    <li><a href="/web/blog/tags/http/">http</a><small>1</small></li>
  
    <li><a href="/web/blog/tags/java/">java</a><small>1</small></li>
  
    <li><a href="/web/blog/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/web/blog/tags/mysql/">mysql</a><small>2</small></li>
  
    <li><a href="/web/blog/tags/node/">node</a><small>1</small></li>
  
    <li><a href="/web/blog/tags/other/">other</a><small>14</small></li>
  
    <li><a href="/web/blog/tags/php/">php</a><small>23</small></li>
  
    <li><a href="/web/blog/tags/python/">python</a><small>1</small></li>
  
    <li><a href="/web/blog/tags/spring/">spring</a><small>1</small></li>
  
    <li><a href="/web/blog/tags/tool/">tool</a><small>7</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2019 hzjoyous
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/web/blog/js/jquery-3.4.1.min.js"></script>

<script src="/web/blog/js/jquery.imagesloaded.min.js"></script>
<script src="/web/blog/js/gallery.js"></script>




<link rel="stylesheet" href="/web/blog/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/web/blog/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
